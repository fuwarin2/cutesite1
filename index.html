<script>
  const form = document.getElementById('estimate-form');
  const radios = form.querySelectorAll('input[type="radio"]');
  const totalDisplay = document.getElementById('total');

  function calculateTotal() {
    let base = 0;
    let size = 0;
    let usePercentage = 0;

    radios.forEach(radio => {
      if (radio.checked) {
        const name = radio.name;
        const value = parseInt(radio.value, 10);
        if (name === 'style') base = value;
        else if (name === 'size') size = value;
        else if (name === 'use') usePercentage = value;
      }
    });

    const subtotal = base + size;
    const final = usePercentage === 50 ? Math.floor(subtotal * 1.5) : subtotal;
    totalDisplay.textContent = `合計金額: ${final.toLocaleString()}円`;
    return final;
  }

  radios.forEach(radio => {
    radio.addEventListener('change', calculateTotal);
  });

  function getLabelText(name) {
    const selected = form.querySelector(`input[name="${name}"]:checked`);
    const label = selected.closest('label');
    return label.textContent.trim();
  }

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const total = calculateTotal();
    const useText = getLabelText('use');
    const sizeText = getLabelText('size');
    const styleText = getLabelText('style');

    const body =
      `見積もり金額: ${total.toLocaleString()}円\n\n` +
      `ご利用用途: ${useText}\n` +
      `納品サイズ: ${sizeText}\n` +
      `キャラクター形式: ${styleText}\n\n` +
      `その他のご希望や詳細をこちらにご記入ください:\n`;

    const subject = 'イラスト見積もりの問い合わせ';
    const mailto = `mailto:cryptoaccont01@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

    window.open(mailto);
  });

  calculateTotal();
</script>
